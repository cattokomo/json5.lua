function lex_string(tokens, str)
    local quote
    quote, str = getchar(str)
    print(quote, str)
    if quote:match("[^'\"]") then
        return str
    end

    local buff = {}
    local has_end_quote
    while #str ~= 0 do
        local c
        c, str = getchar(str)
        print(c, str)
        if c == quote then
            str = str:sub(2)
            has_end_quote = true
            break
        end
        buff[#buff + 1] = c
    end

    buff = table.concat(buff)
    if not has_end_quote then
        return nil, "expected end-of-string quote"
    end

    tokens[#tokens + 1] = buff
    return str
end
